## Create a docker file to create docker image
```
# Use the official Python image
FROM python:3.12.8

# Set the working directory
WORKDIR /tinytechservices

# This command put requirements.txt in container in specific directory
COPY ./requirements.txt /tinytechservices/requirements.txt


# This command will install dependancies in docker container
RUN pip install --no-cache-dir --upgrade -r /tinytechservices/requirements.txt

# copy source code files and directory in docker container
COPY ./app /tinytechservices/app

# this is default command. It will run after container start
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]

```

## Create the image
1. push this image in docker hub. because kubernetes pull the image.
```
atul@atul-Lenovo-G570:~/tinytechservices$ docker build -t tinytechservices:1.0 .

```

## Create the namespace

1. namespace used to create separate environment for a project in a cluster of kubernetes. kubernetes automatically create a `default` namespace
2. create namespace 
  - first check the status. command `$ minikube status`
  - first start the `minikube` if not start. command: `$ minikube start`
    ```
    atul@atul-Lenovo-G570:~$ minikube start
    ```
  - creat namesapce. command `$ kubectl create namespace <namesapcename>`
    ```
    atul@atul-Lenovo-G570:~$ kubectl create namespace tinytechservices-namespace
    ```
3. Note: kubernetes support alphanumeric characters(a-z,0-9) and hyphen (-) for the name space name but underscore(_) and capital letters does not supported by kubernetes for the name space.


## Create a deployment.yml file
```
apiVersion: apps/v1  # Specifies the API version used for deployment
kind: Deployment  # Defines that this is a Deployment resource in Kubernetes
metadata:
  name: tinytechservicesdeployment  # The name of the deployment. You can write according to you
  namespace: tinytechservices-namespace  # The custom namespace where this deployment will be created

spec:
  replicas: 2  # Number of pod instances to run (can be scaled up/down)
  selector:
    matchLabels:
      app: tinytechservicespods  # Must match the label in the template section below

  template:  # Defines the pod structure within the deployment
    metadata:
      labels:
        app: tinytechservicespods  # Corrected: This must match the selector above
    spec:
      containers:
      - name: tinytechservicescontainer  # Name of the container inside the pod. kubernetes automatically creates this container in pods
        image: atulkrishnathakur/tinytechservices:1.0  # Docker image used to create the container. Give here <username>/<imagename>:<tag> of dockerhub
        ports:
        - containerPort: 8000  # The port on which the FastAPI application runs inside the container

```

## create the service.yml file
```
apiVersion: v1  # Specifies the API version for the service
kind: Service  # Defines that this is a Service resource in Kubernetes
metadata:
  name: tinytechservices-service  # The name of the service
  namespace: tinytechservices-namespace  # Ensures the service exists in the same namespace as the deployment

spec:
  type: NodePort  # Exposes the service to the host machine for external access
  selector:
    app: tinytechservicespods  # This should match the label in Deployment.yaml to link the service to the correct pods
  ports:
  - protocol: TCP  # Defines the communication protocol
    port: 80  # The port exposed for external access
    targetPort: 8000  # The port inside the container where the FastAPI app is running

```


## Apply deployment.yml and service.yml with Namespace for the deployment

1. apply the deployment.yml file
```
atul@atul-Lenovo-G570:~$ kubectl apply -f /home/atul/tinytechservices/deployment.yml --namespace=tinytechservices-namespace

```

2. apply the service.yml file
```
atul@atul-Lenovo-G570:~$ kubectl apply -f /home/atul/tinytechservices/service.yml --namespace=tinytechservices-namespace

```

## check the deployment
1. check the status of pods. command: `$ kubectl get pods --namespace=<namespace name>`. If status is `Running` it means all is good.
2. `tinytechservicesdeployment-868fb86c4d-26zdd` it the name of a pod. It is generated by kubernetes automaticall. it the `tinytechservicesdeployment` deployment name that is define in `deployment.yml` file. `868fb86c4d` it is the `ReplicaSet` indentifier.
3. `26zdd` it is the pod suffix to make unique pod. 

```
atul@atul-Lenovo-G570:~$ kubectl get pods --namespace=tinytechservices-namespace
NAME                                          READY   STATUS    RESTARTS   AGE
tinytechservicesdeployment-868fb86c4d-26zdd   1/1     Running   0          13m
tinytechservicesdeployment-868fb86c4d-6fc4w   1/1     Running   0          13m

```

2. Check status of deployment. command `$ kubectl get deployments --namespace=<namespace>`. If in READY you `2/2` or `1/1`. It means pods deployed successfully.
```
atul@atul-Lenovo-G570:~$ kubectl get deployments --namespace=tinytechservices-namespace
NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
tinytechservicesdeployment   2/2     2            2           23m

```

3. Check the status of service. command `atul@atul-Lenovo-G570:~$ kubectl get services --namespace=<namespace>`. If Cluster-IP ya NodePort is visible it means application will be access.
```
atul@atul-Lenovo-G570:~$ kubectl get services --namespace=tinytechservices-namespace
NAME                       TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
tinytechservices-service   NodePort   10.111.180.58   <none>        80:31637/TCP   22m

```

4. check the log
- `tinytechservicesdeployment-868fb86c4d-26zdd` it the name of a pod. It is generated by kubernetes automaticall.
```
atul@atul-Lenovo-G570:~$ kubectl logs tinytechservicesdeployment-868fb86c4d-26zdd --namespace=tinytechservices-namespace
INFO:     Started server process [1]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
WARNING:  Invalid HTTP request received.
WARNING:  Invalid HTTP request received.
atul@atul-Lenovo-G570:~$ kubectl logs tinytechservicesdeployment-868fb86c4d-6fc4w --namespace=tinytechservices-namespace
INFO:     Started server process [1]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     10.244.0.1:40517 - "GET / HTTP/1.1" 200 OK
INFO:     10.244.0.1:39019 - "GET / HTTP/1.1" 200 OK
INFO:     10.244.0.1:56948 - "GET /docs HTTP/1.1" 200 OK
INFO:     10.244.0.1:56948 - "GET /openapi.json HTTP/1.1" 200 OK
```

5. check the pod and deployment details
- `tinytechservicesdeployment-868fb86c4d-26zdd` it the name of a pod. It is generated by kubernetes automaticall.
```
atul@atul-Lenovo-G570:~$ kubectl describe pod tinytechservicesdeployment-868fb86c4d-26zdd --namespace=tinytechservices-namespace

```

```
atul@atul-Lenovo-G570:~$ kubectl describe pod tinytechservicesdeployment-868fb86c4d-6fc4w --namespace=tinytechservices-namespace
```


## check the service node port
1. if in `service.yml` file service type is `NodePort` then kubernetes automatically port between `30000-32767` range.

```
atul@atul-Lenovo-G570:~$ kubectl get svc tinytechservices-service --namespace=tinytechservices-namespace --output yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"name":"tinytechservices-service","namespace":"tinytechservices-namespace"},"spec":{"ports":[{"port":80,"protocol":"TCP","targetPort":8000}],"selector":{"app":"tinytechservicespods"},"type":"NodePort"}}
  creationTimestamp: "2025-04-24T05:26:17Z"
  name: tinytechservices-service
  namespace: tinytechservices-namespace
  resourceVersion: "12848"
  uid: f8b881c9-493b-4306-800c-0cc246ca91cf
spec:
  clusterIP: 10.111.180.58
  clusterIPs:
  - 10.111.180.58
  externalTrafficPolicy: Cluster
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - nodePort: 31637
    port: 80
    protocol: TCP
    targetPort: 8000
  selector:
    app: tinytechservicespods
  sessionAffinity: None
  type: NodePort
status:
  loadBalancer: {}

```
## check the ip by command
```
minikube ip
```

## now check in browser
1. open in browser. `31637` it is the port of `nodePort`
```
http://192.168.49.2:31637/docs
```